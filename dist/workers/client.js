import e,{EncodedContent as t,ContentTypeId as s,ListMessagesOptions as i,ListConversationsOptions as n,CreateGroupOptions as r,CreateDMOptions as a,Consent as o,PermissionPolicySet as c,GroupPermissionsOptions as d,MessageDisappearingSettings as u,getInboxIdForIdentifier as l,generateInboxId as g,createClient as p,LogOptions as m,ConversationType as I,verifySignedWithPublicKey as y}from"@xmtp/wasm-bindings";import{ContentTypeId as v}from"@xmtp/content-type-primitives";const b=e=>{return new t((i=e.type,new s(i.authorityId,i.typeId,i.versionMajor,i.versionMinor)),new Map(Object.entries(e.parameters)),e.fallback,e.compression,e.content);var i},h=e=>{return{type:(t=e.type,{authorityId:t.authorityId,typeId:t.typeId,versionMajor:t.versionMajor,versionMinor:t.versionMinor}),parameters:e.parameters,fallback:e.fallback,compression:e.compression,content:e.content};var t},f=e=>{return{type:(t=e.type,new v({authorityId:t.authorityId,typeId:t.typeId,versionMajor:t.versionMajor,versionMinor:t.versionMinor})),parameters:e.parameters,fallback:e.fallback,compression:e.compression,content:e.content};var t},w=e=>{return{content:h((t=e.content,{type:(s=t.type,new v({authorityId:s.authorityId,typeId:s.typeId,versionMajor:s.versionMajor,versionMinor:s.versionMinor})),parameters:Object.fromEntries(t.parameters),fallback:t.fallback,compression:t.compression,content:t.content})),convoId:e.convoId,deliveryStatus:e.deliveryStatus,id:e.id,kind:e.kind,senderInboxId:e.senderInboxId,sentAtNs:e.sentAtNs};var t,s},S=e=>new n(e.consentStates,e.conversationType,e.createdAfterNs,e.createdBeforeNs,e.includeDuplicateDms??!1,e.limit),k=e=>{return new r(e.permissions,e.name,e.imageUrlSquare,e.description,e.customPermissionPolicySet&&e.permissions===d.CustomPolicy?(t=e.customPermissionPolicySet,new c(t.addMemberPolicy,t.removeMemberPolicy,t.addAdminPolicy,t.removeAdminPolicy,t.updateGroupNamePolicy,t.updateGroupDescriptionPolicy,t.updateGroupImageUrlSquarePolicy,t.updateMessageDisappearingPolicy)):void 0,e.messageDisappearingSettings?_(e.messageDisappearingSettings):void 0);var t},x=e=>new a(e.messageDisappearingSettings?_(e.messageDisappearingSettings):void 0),A=async e=>{const t=e.id,s=e.name,i=e.imageUrl,n=e.description,r=e.permissions,a=e.isActive,o=e.addedByInboxId,c=await e.metadata(),d=e.admins,u=e.superAdmins,l=e.createdAtNs,g=r.policyType,p=r.policySet,m=e.isCommitLogForked;return{id:t,name:s,imageUrl:i,description:n,permissions:{policyType:g,policySet:{addAdminPolicy:p.addAdminPolicy,addMemberPolicy:p.addMemberPolicy,removeAdminPolicy:p.removeAdminPolicy,removeMemberPolicy:p.removeMemberPolicy,updateGroupDescriptionPolicy:p.updateGroupDescriptionPolicy,updateGroupImageUrlSquarePolicy:p.updateGroupImageUrlSquarePolicy,updateGroupNamePolicy:p.updateGroupNamePolicy,updateMessageDisappearingPolicy:p.updateMessageDisappearingPolicy}},isActive:a,addedByInboxId:o,metadata:c,admins:d,superAdmins:u,createdAtNs:l,isCommitLogForked:m}},M=e=>({bytes:e.bytes,clientTimestampNs:e.clientTimestampNs,id:e.id}),q=e=>({identifiers:e.accountIdentifiers,inboxId:e.inboxId,installations:e.installations.map(M),recoveryIdentifier:e.recoveryIdentifier}),R=e=>({entity:e.entity,entityType:e.entityType,state:e.state}),D=e=>new o(e.entityType,e.state,e.entity),P=e=>({key:e.key,epoch:e.epoch}),_=e=>new u(e.fromNs,e.inNs),C=e=>({lifetime:e.lifetime?{notBefore:e.lifetime.not_before,notAfter:e.lifetime.not_after}:void 0,validationError:e.validationError});class T extends Error{constructor(){super("Client not initialized, use Client.create or Client.build to create a client")}}class B extends Error{constructor(e){super(`Group "${e}" not found`)}}class G extends Error{constructor(e){super(`Stream "${e}" not found`)}}const L={local:"http://localhost:5555",dev:"https://dev.xmtp.network",production:"https://production.xmtp.network"},N={local:"http://localhost:5558",dev:"https://message-history.dev.ephemera.network",production:"https://message-history.production.ephemera.network"};class F{#e;#t;#s;constructor(e,t,s){this.#e=e,this.#t=t,this.#s=s}get id(){return this.#t.id()}get name(){return this.#t.groupName()}async updateName(e){return this.#t.updateGroupName(e)}get imageUrl(){return this.#t.groupImageUrlSquare()}async updateImageUrl(e){return this.#t.updateGroupImageUrlSquare(e)}get description(){return this.#t.groupDescription()}async updateDescription(e){return this.#t.updateGroupDescription(e)}get isActive(){return this.#t.isActive()}get isCommitLogForked(){return this.#s}get addedByInboxId(){return this.#t.addedByInboxId()}get createdAtNs(){return this.#t.createdAtNs()}async metadata(){const e=await this.#t.groupMetadata();return{creatorInboxId:e.creatorInboxId(),conversationType:e.conversationType()}}async members(){return(await this.#t.listMembers()).map(e=>(e=>({accountIdentifiers:e.accountIdentifiers,consentState:e.consentState,inboxId:e.inboxId,installationIds:e.installationIds,permissionLevel:e.permissionLevel}))(e))}get admins(){return this.#t.adminList()}get superAdmins(){return this.#t.superAdminList()}get permissions(){const e=this.#t.groupPermissions();return{policyType:e.policyType(),policySet:e.policySet()}}async updatePermission(e,t,s){return this.#t.updatePermissionPolicy(e,t,s)}isAdmin(e){return this.#t.isAdmin(e)}isSuperAdmin(e){return this.#t.isSuperAdmin(e)}async sync(){return this.#t.sync()}async addMembersByIdentifiers(e){return this.#t.addMembers(e)}async addMembers(e){return this.#t.addMembersByInboxId(e)}async removeMembersByIdentifiers(e){return this.#t.removeMembers(e)}async removeMembers(e){return this.#t.removeMembersByInboxId(e)}async addAdmin(e){return this.#t.addAdmin(e)}async removeAdmin(e){return this.#t.removeAdmin(e)}async addSuperAdmin(e){return this.#t.addSuperAdmin(e)}async removeSuperAdmin(e){return this.#t.removeSuperAdmin(e)}async publishMessages(){return this.#t.publishMessages()}sendOptimistic(e){return this.#t.sendOptimistic(e)}async send(e){return this.#t.send(e)}async messages(e){return this.#t.findMessages(e?(e=>new i(e.sentBeforeNs,e.sentAfterNs,e.limit,e.deliveryStatus,e.direction,e.contentTypes))(e):void 0)}get consentState(){return this.#t.consentState()}updateConsentState(e){this.#t.updateConsentState(e)}dmPeerInboxId(){return this.#t.dmPeerInboxId()}messageDisappearingSettings(){return this.#t.messageDisappearingSettings()}async updateMessageDisappearingSettings(e,t){const s=new u(e,t);return this.#t.updateMessageDisappearingSettings(s)}async removeMessageDisappearingSettings(){return this.#t.removeMessageDisappearingSettings()}isMessageDisappearingEnabled(){return this.#t.isMessageDisappearingEnabled()}stream(e,t){return this.#t.stream({on_message:t=>{e(null,t)},on_error:t=>{e(t,void 0)},on_close:()=>{t()}})}pausedForVersion(){return this.#t.pausedForVersion()}getHmacKeys(){return this.#t.getHmacKeys()}async debugInfo(){return await this.#t.getDebugInfo()}async getDuplicateDms(){return(await this.#t.findDuplicateDms()).map(e=>new F(this.#e,e))}}class K{#e;#i;constructor(e,t){this.#e=e,this.#i=t}async sync(){return this.#i.sync()}async syncAll(e){return this.#i.syncAllConversations(e)}getConversationById(e){try{const t=this.#i.findGroupById(e);return new F(this.#e,t)}catch{return}}getMessageById(e){try{return this.#i.findMessageById(e)}catch{return}}getDmByInboxId(e){try{const t=this.#i.findDmByTargetInboxId(e);return new F(this.#e,t)}catch{return}}list(e){return this.#i.list(e?S(e):void 0).map(e=>new F(this.#e,e.conversation,e.isCommitLogForked))}listGroups(e){return this.#i.list(S({...e??{},conversationType:I.Group})).map(e=>new F(this.#e,e.conversation,e.isCommitLogForked))}listDms(e){return this.#i.list(S({...e??{},conversationType:I.Dm})).map(e=>new F(this.#e,e.conversation,e.isCommitLogForked))}newGroupOptimistic(e){const t=this.#i.createGroupOptimistic(e?k(e):void 0);return new F(this.#e,t)}async newGroupWithIdentifiers(e,t){const s=await this.#i.createGroup(e,t?k(t):void 0);return new F(this.#e,s)}async newGroup(e,t){const s=await this.#i.createGroupByInboxIds(e,t?k(t):void 0);return new F(this.#e,s)}async newDmWithIdentifier(e,t){const s=await this.#i.createDm(e,t?x(t):void 0);return new F(this.#e,s)}async newDm(e,t){const s=await this.#i.createDmByInboxId(e,t?x(t):void 0);return new F(this.#e,s)}getHmacKeys(){return this.#i.getHmacKeys()}stream(e,t,s){return this.#i.stream({on_conversation:t=>{e(null,t)},on_error:t=>{e(t,void 0)},on_close:()=>{t()}},s)}streamGroups(e,t){return this.stream(e,t,I.Group)}streamDms(e,t){return this.stream(e,t,I.Dm)}streamAllMessages(e,t,s,i){return this.#i.streamAllMessages({on_message:t=>{e(null,t)},on_error:t=>{e(t,void 0)},on_close:()=>{t()}},s,i)}}class W{#e;#n;constructor(e,t){this.#e=e,this.#n=t}apiStatistics(){return this.#e.apiStatistics()}apiIdentityStatistics(){return this.#e.apiIdentityStatistics()}apiAggregateStatistics(){return this.#e.apiAggregateStatistics()}clearAllStatistics(){this.#e.clearAllStatistics()}uploadDebugArchive(e){const t=this.#n?.env||"dev",s=this.#n?.historySyncUrl||N[t];return this.#e.uploadDebugArchive(e||s)}}class E{#e;#i;constructor(e,t){this.#e=e,this.#i=t}sync(){return this.#e.syncPreferences()}async inboxState(e){return this.#e.inboxState(e)}async inboxStateFromInboxIds(e,t){return this.#e.inboxStateFromInboxIds(e,t??!1)}async getLatestInboxState(e){return this.#e.getLatestInboxState(e)}async setConsentStates(e){return this.#e.setConsentStates(e.map(D))}async getConsentState(e,t){return this.#e.getConsentState(e,t)}streamConsent(e,t){return this.#i.streamConsent({on_consent_update:t=>{e(null,t)},on_error:t=>{e(t,void 0)},on_close:()=>{t()}})}streamPreferences(e,t){return this.#i.streamPreferences({on_user_preference_update:t=>{e(null,t)},on_error:t=>{e(t,void 0)},on_close:()=>{t()}})}}class U{#e;#i;#r;#a;constructor(e,t){this.#e=e;const s=e.conversations();this.#i=new K(this,s),this.#r=new W(e,t),this.#a=new E(e,s)}static async create(e,t){const s=await(async(e,t)=>{const s=t?.env||"dev",i=t?.apiUrl||L[s],n=await l(i,e)||g(e),r=void 0===t?.dbPath?`xmtp-${s}-${n}.db3`:t.dbPath,a=t&&(void 0!==t.loggingLevel||t.structuredLogging||t.performanceLogging),o=void 0===t?.historySyncUrl?N[s]:t.historySyncUrl,c=t?.disableDeviceSync?"disabled":"enabled";return p(i,n,e,r,t?.dbEncryptionKey,o,c,a?new m(t.structuredLogging??!1,t.performanceLogging??!1,t.loggingLevel):void 0,void 0,t?.debugEventsEnabled,t?.appVersion)})(e,t);return new U(s,t)}get accountIdentifier(){return this.#e.accountIdentifier}get inboxId(){return this.#e.inboxId}get installationId(){return this.#e.installationId}get installationIdBytes(){return this.#e.installationIdBytes}get isRegistered(){return this.#e.isRegistered}get conversations(){return this.#i}get debugInformation(){return this.#r}get preferences(){return this.#a}async canMessage(e){return this.#e.canMessage(e)}async addSignature(e,t){switch(t.type){case"SCW":await e.addScwSignature(t.identifier,t.signature,t.chainId,t.blockNumber);break;case"EOA":await e.addEcdsaSignature(t.signature)}}async applySignatureRequest(e){return this.#e.applySignatureRequest(e)}async processSignatureRequest(e,t){await this.addSignature(t,e),await this.applySignatureRequest(t)}createInboxSignatureRequest(){return this.#e.createInboxSignatureRequest()}async addAccountSignatureRequest(e){return this.#e.addWalletSignatureRequest(e)}async removeAccountSignatureRequest(e){return this.#e.revokeWalletSignatureRequest(e)}async revokeAllOtherInstallationsSignatureRequest(){return this.#e.revokeAllOtherInstallationsSignatureRequest()}async revokeInstallationsSignatureRequest(e){return this.#e.revokeInstallationsSignatureRequest(e)}async changeRecoveryIdentifierSignatureRequest(e){return this.#e.changeRecoveryIdentifierSignatureRequest(e)}async registerIdentity(e,t){await this.addSignature(t,e),await this.#e.registerIdentity(t)}async findInboxIdByIdentifier(e){return this.#e.findInboxIdByIdentifier(e)}signWithInstallationKey(e){return this.#e.signWithInstallationKey(e)}verifySignedWithInstallationKey(e,t){try{return this.#e.verifySignedWithInstallationKey(e,t),!0}catch{return!1}}verifySignedWithPublicKey(e,t,s){try{return y(e,t,s),!0}catch{return!1}}async getKeyPackageStatusesForInstallationIds(e){return this.#e.getKeyPackageStatusesForInstallationIds(e)}}let O,j=!1;const H=new Map,V=new Map,$=e=>{self.postMessage(e)},z=e=>{self.postMessage(e)},J=e=>{self.postMessage(e)};self.onmessage=async t=>{const{action:s,id:i,data:n}=t.data;j&&console.log("client worker received event data",t.data),await e();try{if("client.init"===s&&!O)return O=await U.create(n.identifier,n.options),j=void 0!==n.options?.loggingLevel&&"off"!==n.options.loggingLevel,void $({id:i,action:s,result:{inboxId:O.inboxId,installationId:O.installationId,installationIdBytes:O.installationIdBytes}});if(!O)throw new T;const e=O,t=t=>{const s=e.conversations.getConversationById(t);if(!s)throw new B(t);return s};switch(s){case"endStream":{const e=H.get(n.streamId);if(!e)throw new G(n.streamId);e.end(),H.delete(n.streamId),$({id:i,action:s,result:void 0});break}case"client.applySignatureRequest":{const t=V.get(n.signatureRequestId);if(!t)throw new Error("Signature request not found");await e.processSignatureRequest(n.signer,t),V.delete(n.signatureRequestId),$({id:i,action:s,result:void 0});break}case"client.createInboxSignatureText":{const t={signatureText:void 0,signatureRequestId:void 0};try{const s=e.createInboxSignatureRequest();s&&(t.signatureText=await s.signatureText(),t.signatureRequestId=n.signatureRequestId,V.set(n.signatureRequestId,s))}finally{$({id:i,action:s,result:t})}break}case"client.addAccountSignatureText":{const t=await e.addAccountSignatureRequest(n.newIdentifier),r={signatureText:await t.signatureText(),signatureRequestId:n.signatureRequestId};V.set(n.signatureRequestId,t),$({id:i,action:s,result:r});break}case"client.removeAccountSignatureText":{const t=await e.removeAccountSignatureRequest(n.identifier),r={signatureText:await t.signatureText(),signatureRequestId:n.signatureRequestId};V.set(n.signatureRequestId,t),$({id:i,action:s,result:r});break}case"client.revokeAllOtherInstallationsSignatureText":{const t=await e.revokeAllOtherInstallationsSignatureRequest(),r={signatureText:await t.signatureText(),signatureRequestId:n.signatureRequestId};V.set(n.signatureRequestId,t),$({id:i,action:s,result:r});break}case"client.revokeInstallationsSignatureText":{const t=await e.revokeInstallationsSignatureRequest(n.installationIds),r={signatureText:await t.signatureText(),signatureRequestId:n.signatureRequestId};V.set(n.signatureRequestId,t),$({id:i,action:s,result:r});break}case"client.changeRecoveryIdentifierSignatureText":{const t=await e.changeRecoveryIdentifierSignatureRequest(n.identifier),r={signatureText:await t.signatureText(),signatureRequestId:n.signatureRequestId};V.set(n.signatureRequestId,t),$({id:i,action:s,result:r});break}case"client.registerIdentity":{const t=V.get(n.signatureRequestId);if(!t)throw new Error("Signature request not found");await e.registerIdentity(n.signer,t),V.delete(n.signatureRequestId),$({id:i,action:s,result:void 0});break}case"client.addAccount":{const t=V.get(n.signatureRequestId);if(!t)throw new Error("Signature request not found");await e.processSignatureRequest(n.signer,t),V.delete(n.signatureRequestId),$({id:i,action:s,result:void 0});break}case"client.removeAccount":{const t=V.get(n.signatureRequestId);if(!t)throw new Error("Signature request not found");await e.processSignatureRequest(n.signer,t),V.delete(n.signatureRequestId),$({id:i,action:s,result:void 0});break}case"client.revokeAllOtherInstallations":{const t=V.get(n.signatureRequestId);if(!t)throw new Error("Signature request not found");await e.processSignatureRequest(n.signer,t),V.delete(n.signatureRequestId),$({id:i,action:s,result:void 0});break}case"client.revokeInstallations":{const t=V.get(n.signatureRequestId);if(!t)throw new Error("Signature request not found");await e.processSignatureRequest(n.signer,t),V.delete(n.signatureRequestId),$({id:i,action:s,result:void 0});break}case"client.changeRecoveryIdentifier":{const t=V.get(n.signatureRequestId);if(!t)throw new Error("Signature request not found");await e.processSignatureRequest(n.signer,t),V.delete(n.signatureRequestId),$({id:i,action:s,result:void 0});break}case"client.isRegistered":{const t=e.isRegistered;$({id:i,action:s,result:t});break}case"client.canMessage":{const t=await e.canMessage(n.identifiers);$({id:i,action:s,result:t});break}case"client.findInboxIdByIdentifier":{const t=await e.findInboxIdByIdentifier(n.identifier);$({id:i,action:s,result:t});break}case"client.signWithInstallationKey":{const t=e.signWithInstallationKey(n.signatureText);$({id:i,action:s,result:t});break}case"client.verifySignedWithInstallationKey":{const t=e.verifySignedWithInstallationKey(n.signatureText,n.signatureBytes);$({id:i,action:s,result:t});break}case"client.verifySignedWithPublicKey":{const t=e.verifySignedWithPublicKey(n.signatureText,n.signatureBytes,n.publicKey);$({id:i,action:s,result:t});break}case"client.getKeyPackageStatusesForInstallationIds":{const t=await e.getKeyPackageStatusesForInstallationIds(n.installationIds),r=new Map(Array.from(t.entries()).map(([e,t])=>[e,C(t)]));$({id:i,action:s,result:r});break}case"debugInformation.apiStatistics":{const t=e.debugInformation.apiStatistics(),n={uploadKeyPackage:(r=t).upload_key_package,fetchKeyPackage:r.fetch_key_package,sendGroupMessages:r.send_group_messages,sendWelcomeMessages:r.send_welcome_messages,queryGroupMessages:r.query_group_messages,queryWelcomeMessages:r.query_welcome_messages,subscribeMessages:r.subscribe_messages,subscribeWelcomes:r.subscribe_welcomes};$({id:i,action:s,result:n});break}case"debugInformation.apiIdentityStatistics":{const t=(e=>({getIdentityUpdatesV2:e.get_identity_updates_v2,getInboxIds:e.get_inbox_ids,publishIdentityUpdate:e.publish_identity_update,verifySmartContractWalletSignature:e.verify_smart_contract_wallet_signature}))(e.debugInformation.apiIdentityStatistics());$({id:i,action:s,result:t});break}case"debugInformation.apiAggregateStatistics":{const t=e.debugInformation.apiAggregateStatistics();$({id:i,action:s,result:t});break}case"debugInformation.clearAllStatistics":e.debugInformation.clearAllStatistics(),$({id:i,action:s,result:void 0});break;case"debugInformation.uploadDebugArchive":{const t=await e.debugInformation.uploadDebugArchive(n.serverUrl);$({id:i,action:s,result:t});break}case"preferences.inboxState":{const t=await e.preferences.inboxState(n.refreshFromNetwork),r=q(t);$({id:i,action:s,result:r});break}case"preferences.inboxStateFromInboxIds":{const t=(await e.preferences.inboxStateFromInboxIds(n.inboxIds,n.refreshFromNetwork)).map(q);$({id:i,action:s,result:t});break}case"preferences.getLatestInboxState":{const t=await e.preferences.getLatestInboxState(n.inboxId),r=q(t);$({id:i,action:s,result:r});break}case"preferences.setConsentStates":await e.preferences.setConsentStates(n.records),$({id:i,action:s,result:void 0});break;case"preferences.getConsentState":{const t=await e.preferences.getConsentState(n.entityType,n.entity);$({id:i,action:s,result:t});break}case"preferences.sync":{const t=await e.preferences.sync();$({id:i,action:s,result:t});break}case"preferences.streamConsent":{const t=(e,t)=>{e?J({action:"stream.consent",streamId:n.streamId,error:e}):z({action:"stream.consent",streamId:n.streamId,result:t?.map(R)??[]})},r=e.preferences.streamConsent(t,()=>{H.delete(n.streamId),z({action:"stream.fail",streamId:n.streamId,result:void 0})});H.set(n.streamId,r),$({id:i,action:s,result:void 0});break}case"preferences.streamPreferences":{const t=(e,t)=>{e?J({action:"stream.preferences",streamId:n.streamId,error:e}):z({action:"stream.preferences",streamId:n.streamId,result:t??void 0})},r=e.preferences.streamPreferences(t,()=>{H.delete(n.streamId),z({action:"stream.fail",streamId:n.streamId,result:void 0})});H.set(n.streamId,r),$({id:i,action:s,result:void 0});break}case"conversations.stream":{const t=(t,s)=>{t?J({action:"stream.conversation",streamId:n.streamId,error:t}):s?A(new F(e,s)).then(e=>{z({action:"stream.conversation",streamId:n.streamId,result:e})}).catch(e=>{J({action:"stream.conversation",streamId:n.streamId,error:e})}):z({action:"stream.conversation",streamId:n.streamId,result:void 0})},r=e.conversations.stream(t,()=>{H.delete(n.streamId),z({action:"stream.fail",streamId:n.streamId,result:void 0})},n.conversationType);H.set(n.streamId,r),$({id:i,action:s,result:void 0});break}case"conversations.streamAllMessages":{const t=(e,t)=>{e?J({action:"stream.message",streamId:n.streamId,error:e}):z({action:"stream.message",streamId:n.streamId,result:t?w(t):void 0})},r=e.conversations.streamAllMessages(t,()=>{H.delete(n.streamId),z({action:"stream.fail",streamId:n.streamId,result:void 0})},n.conversationType,n.consentStates);H.set(n.streamId,r),$({id:i,action:s,result:void 0});break}case"conversations.list":{const t=e.conversations.list(n.options),r=await Promise.all(t.map(e=>A(e)));$({id:i,action:s,result:r});break}case"conversations.listGroups":{const t=e.conversations.listGroups(n.options),r=await Promise.all(t.map(e=>A(e)));$({id:i,action:s,result:r});break}case"conversations.listDms":{const t=e.conversations.listDms(n.options),r=await Promise.all(t.map(e=>A(e)));$({id:i,action:s,result:r});break}case"conversations.newGroupOptimistic":{const t=e.conversations.newGroupOptimistic(n.options),r=await A(t);$({id:i,action:s,result:r});break}case"conversations.newGroupWithIdentifiers":{const t=await e.conversations.newGroupWithIdentifiers(n.identifiers,n.options),r=await A(t);$({id:i,action:s,result:r});break}case"conversations.newGroup":{const t=await e.conversations.newGroup(n.inboxIds,n.options),r=await A(t);$({id:i,action:s,result:r});break}case"conversations.newDmWithIdentifier":{const t=await e.conversations.newDmWithIdentifier(n.identifier,n.options),r=await A(t);$({id:i,action:s,result:r});break}case"conversations.newDm":{const t=await e.conversations.newDm(n.inboxId,n.options),r=await A(t);$({id:i,action:s,result:r});break}case"conversations.sync":await e.conversations.sync(),$({id:i,action:s,result:void 0});break;case"conversations.syncAll":await e.conversations.syncAll(n.consentStates),$({id:i,action:s,result:void 0});break;case"conversations.getConversationById":{const t=e.conversations.getConversationById(n.id),r=t?await A(t):void 0;$({id:i,action:s,result:r});break}case"conversations.getMessageById":{const t=e.conversations.getMessageById(n.id),r=t?w(t):void 0;$({id:i,action:s,result:r});break}case"conversations.getDmByInboxId":{const t=e.conversations.getDmByInboxId(n.inboxId),r=t?await A(t):void 0;$({id:i,action:s,result:r});break}case"conversations.getHmacKeys":{const t=e.conversations.getHmacKeys(),n=Object.fromEntries(Array.from(t.entries()).map(([e,t])=>[e,t.map(P)]));$({id:i,action:s,result:n});break}case"conversation.sync":{const e=t(n.id);await e.sync();const r=await A(e);$({id:i,action:s,result:r});break}case"conversation.consentState":{const e=t(n.id).consentState;$({id:i,action:s,result:e});break}case"conversation.updateConsentState":t(n.id).updateConsentState(n.state),$({id:i,action:s,result:void 0});break;case"group.updateName":{const e=t(n.id);await e.updateName(n.name),$({id:i,action:s,result:void 0});break}case"group.updateDescription":{const e=t(n.id);await e.updateDescription(n.description),$({id:i,action:s,result:void 0});break}case"group.updateImageUrl":{const e=t(n.id);await e.updateImageUrl(n.imageUrl),$({id:i,action:s,result:void 0});break}case"conversation.send":{const e=t(n.id),r=await e.send(b(f(n.content)));$({id:i,action:s,result:r});break}case"conversation.sendOptimistic":{const e=t(n.id).sendOptimistic(b(f(n.content)));$({id:i,action:s,result:e});break}case"conversation.publishMessages":{const e=t(n.id);await e.publishMessages(),$({id:i,action:s,result:void 0});break}case"conversation.messages":{const e=t(n.id),r=(await e.messages(n.options)).map(e=>w(e));$({id:i,action:s,result:r});break}case"conversation.members":{const e=t(n.id),r=await e.members();$({id:i,action:s,result:r});break}case"group.listAdmins":{const e=t(n.id).admins;$({id:i,action:s,result:e});break}case"group.listSuperAdmins":{const e=t(n.id).superAdmins;$({id:i,action:s,result:e});break}case"group.addAdmin":{const e=t(n.id);await e.addAdmin(n.inboxId),$({id:i,action:s,result:void 0});break}case"group.removeAdmin":{const e=t(n.id);await e.removeAdmin(n.inboxId),$({id:i,action:s,result:void 0});break}case"group.addSuperAdmin":{const e=t(n.id);await e.addSuperAdmin(n.inboxId),$({id:i,action:s,result:void 0});break}case"group.removeSuperAdmin":{const e=t(n.id);await e.removeSuperAdmin(n.inboxId),$({id:i,action:s,result:void 0});break}case"group.addMembersByIdentifiers":{const e=t(n.id);await e.addMembersByIdentifiers(n.identifiers),$({id:i,action:s,result:void 0});break}case"group.removeMembersByIdentifiers":{const e=t(n.id);await e.removeMembersByIdentifiers(n.identifiers),$({id:i,action:s,result:void 0});break}case"group.addMembers":{const e=t(n.id);await e.addMembers(n.inboxIds),$({id:i,action:s,result:void 0});break}case"group.removeMembers":{const e=t(n.id);await e.removeMembers(n.inboxIds),$({id:i,action:s,result:void 0});break}case"group.isAdmin":{const e=t(n.id).isAdmin(n.inboxId);$({id:i,action:s,result:e});break}case"group.isSuperAdmin":{const e=t(n.id).isSuperAdmin(n.inboxId);$({id:i,action:s,result:e});break}case"dm.peerInboxId":{const e=t(n.id).dmPeerInboxId();$({id:i,action:s,result:e});break}case"group.updatePermission":{const e=t(n.id);await e.updatePermission(n.permissionType,n.policy,n.metadataField),$({id:i,action:s,result:void 0});break}case"group.permissions":{const e=t(n.id),r=(await A(e)).permissions;$({id:i,action:s,result:r});break}case"conversation.messageDisappearingSettings":{const e=t(n.id).messageDisappearingSettings(),r=e?(e=>({fromNs:e.fromNs,inNs:e.inNs}))(e):void 0;$({id:i,action:s,result:r});break}case"conversation.updateMessageDisappearingSettings":{const e=t(n.id);await e.updateMessageDisappearingSettings(n.fromNs,n.inNs),$({id:i,action:s,result:void 0});break}case"conversation.removeMessageDisappearingSettings":{const e=t(n.id);await e.removeMessageDisappearingSettings(),$({id:i,action:s,result:void 0});break}case"conversation.isMessageDisappearingEnabled":{const e=t(n.id).isMessageDisappearingEnabled();$({id:i,action:s,result:e});break}case"conversation.stream":{const e=t(n.groupId),r=(e,t)=>{e?J({action:"stream.message",streamId:n.streamId,error:e}):z({action:"stream.message",streamId:n.streamId,result:t?w(t):void 0})},a=e.stream(r,()=>{H.delete(n.streamId),z({action:"stream.fail",streamId:n.streamId,result:void 0})});H.set(n.streamId,a),$({id:i,action:s,result:void 0});break}case"conversation.pausedForVersion":{const e=t(n.id).pausedForVersion();$({id:i,action:s,result:e});break}case"conversation.getHmacKeys":{const e=t(n.id).getHmacKeys();$({id:i,action:s,result:e});break}case"dm.getDuplicateDms":{const e=t(n.id),r=await e.getDuplicateDms(),a=await Promise.all(r.map(e=>A(e)));$({id:i,action:s,result:a});break}case"conversation.debugInfo":{const e=t(n.id),r=(e=>({epoch:e.epoch,maybeForked:e.maybeForked,forkDetails:e.forkDetails,isCommitLogForked:e.isCommitLogForked,localCommitLog:e.localCommitLog,remoteCommitLog:e.remoteCommitLog,cursor:e.cursor}))(await e.debugInfo());$({id:i,action:s,result:r});break}}}catch(e){(e=>{self.postMessage(e)})({id:i,action:s,error:e})}var r};
//# sourceMappingURL=client.js.map
